<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Joker Online</title>
    <link rel="stylesheet" href="node_modules/deck-of-cards/example/example.css">
</head>
<body>
    <div id="main">
        <g>
            <div id="container"></div>
        </g>
        <div id="topbar"></div><a href="https://github.com/pakastin/deck-of-cards">
    <script src="node_modules/deck-of-cards/dist/deck.min.js"></script>

    <script>

        class Card {
            constructor(value, suit) {
                this.value = value;
                this.suit = suit;
            }
        }

        
        class StandardJokerDeck {
            constructor() {
                this.suits = [0, 1, 2, 3]; // Diamonds, Clubs, Hearts, Spades
                this.values = [7, 8, 9, 10, 11, 12, 13, 14];
                this.cards = [];
                for (var i = 0; i < this.suits.length; i++){ // suits 0 - 3 (H,D,S,C)
                    for (var j = 0; j < this.values.length; j++){ // values 7 - Ace
                        this.cards.push(new Card(j, i));
                    }
                }
                
                // Add Sixes
                this.cards.push(new Card(6, 0));
                this.cards.push(new Card(6, 2));
            
                // Add Jokers
                this.cards.push(new Card(13, 1));
                this.cards.push(new Card(13, 3));
            }

            shuffle(){
                this.cards.sort(() => (Math.random() > .5) ? 1 : -1);
            }

            get(index){
                return this.cards[index];
            }
            
            deal(location, number){
                for(var i = 0; i < number; i++)
                location.push(this.cards.pop());
            }
        }


        class Player {
            constructor(id_in){
                this.id = id_in;
                this.score = 0;
                this.cards = [];
                this.called = 0;
                this.taken = 0;
            }
        }

        class Game { 
            constructor() { 
                this.deck = new StandardJokerDeck();
                this.wildcard = new Card(0,0);
                this.first_suit = new Card(0,5);
                this.cards_dealt = 0;
                this.round = 0;
                this.play = 0;
                this.users = [new Player(0), new Player(1), new Player(2), new Player(3)];
                this.dealer = Math.floor(Math.random() * 4);
                // this.simulation = Boolean(false);
                // this.model = None
            }

            get_place_in_playing_order(player_id){
                var dealer = this.dealer;
                var out = 5;
                for (var i = 1; i < 6; i++){
                    if ((dealer + i) % 4 == player_id){
                        out = i;
                    }
                }
                return out;
            }

            get_wildsuit(){
                if (this.wildcard.value != 13){
                    return this.wildcard.suit;
                } else {
                    return 4;
                }
            }

            set_dealer(){
                this.dealer = (this.dealer + 1) % 4;
            }

            update_round(){ 
                this.set_dealer();
                
                if (this.round == 1 && this.play == 8){
                    this.round += 1;
                    this.play = 1;
                } else if (this.round == 0 && this.play == 0) {
                    this.round = 1;
                    this.play = 1;
                } else if (this.round == 2 && this.play == 4) {
                    this.round = 3;
                    this.play = 1;
                } else if (this.round == 3 && this.play == 8 ) {
                    this.round = 4;
                    this.play = 1;
                } else {
                    this.play += 1;
                }

                if (this.round == 1 || this.round == 3) {
                    this.cards_dealt = this.play;
                } else {
                    this.cards_dealt = 9;
                }
            }

            set_calls(u0, u1, u2, u3){
                this.users[0].called = u0;
                this.users[1].called = u1;
                this.users[2].called = u2;
                this.users[3].called = u3;
            }

            get_play_index_of_game(){
                if (this.round == 1) {
                    return (this.play - 1);
                } else if (this.round == 2) {
                    return (this.play + 7);
                } else if (this.round == 3) {
                    return (this.play + 11);
                } else if (this.round == 4) {
                    return (this.play + 19);
                } else {
                    return 100;
                }
            }

            deal_to_users(){
                this.deck.shuffle()
                for (var i = 0; i < 4; i++) {
                    this.deck.deal(this.users[i], this.cards_dealt);
                }
            }
            
            set_wildcard() {
                var choice, choices;

                if (this.round === 2 || this.round === 4) {
                    choices = this.users[(this.dealer + 1) % 4].cards.slice(0, 3);
                    choice = this.get_wild_choice(choices, dealer);
                    this.wildcard = choices[choice];
                } else {
                    this.wildcard = this.deck[0];
                }
            }

            card_to_weight(card) {
                var weight;
                weight = 0;

                if (card.suit === this.get_wildsuit()) {
                    weight += 200;
                } else {
                    if (card.suit === this.first_suit) {
                    weight += 100;
                    }
                }

                if (card.value === 13) {
                    weight += 400;
                } else {
                    weight += (card.value);
                }

                return weight;
            }

            
        }

        var deck = new StandardJokerDeck();
        var player = new Player(0);
        var gane = new Game();
        // console.log(player.id);















        var $container = document.getElementById('container');
        var deck = Deck();
        console.log(deck.cards)
        // Select the first card
        var card = deck.cards[0];

        // Add it to an html container
        // deck.mount($container);

        card.mount($container)

        // Allow to move/drag it
        card.enableDragging();

        // Allow to flip it
        card.setSide('front')

        var $topbar = document.getElementById('topbar')

        var $sort = document.createElement('button')
        var $shuffle = document.createElement('button')
        var $bysuit = document.createElement('button')
        var $fan = document.createElement('button')
        var $poker = document.createElement('button')
        var $flip = document.createElement('button')

        $shuffle.textContent = 'Shuffle'
        $sort.textContent = 'Sort'
        $bysuit.textContent = 'By suit'
        $fan.textContent = 'Fan'
        $poker.textContent = 'Poker'
        $flip.textContent = 'Flip'

        $topbar.appendChild($flip)
        $topbar.appendChild($shuffle)
        $topbar.appendChild($bysuit)
        $topbar.appendChild($fan)
        $topbar.appendChild($poker)
        $topbar.appendChild($sort)


    </script>
</body>
<script src="https://d3js.org/d3.v5.min.js"></script>
</html>  